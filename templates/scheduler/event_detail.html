{% extends "base.html" %}
{% load tz %}
{% block title %}{{ e.title }}{% endblock %}
{% block content %}
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h2 class="mb-0"><i class="bi bi-eye me-2"></i>{{ e.title }}</h2>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-secondary btn-sm" href="{% url 'scheduler_web:events' %}"><i class="bi bi-arrow-left"></i> Voltar</a>
      <a class="btn btn-outline-primary btn-sm" href="{% url 'event-export-ics' e.id %}"><i class="bi bi-download"></i> ICS</a>
      <button class="btn btn-outline-secondary btn-sm" id="copyIcs"><i class="bi bi-clipboard"></i> Copiar link ICS</button>
    </div>
  </div>

  <div class="row g-3">
    <div class="col-md-6">
      <div class="card card-rounded shadow-soft h-100">
        <div class="card-body">
          <h5 class="card-title"><i class="bi bi-clock me-2"></i>Quando</h5>
          <p class="mb-1"><strong>Início:</strong> {{ e.start|localtime|date:"d/m/Y H:i" }}</p>
          <p class="mb-1"><strong>Fim:</strong> {{ e.end|localtime|date:"d/m/Y H:i" }}</p>
          {% if e.is_all_day %}<span class="badge text-bg-success mt-2"><i class="bi bi-sun me-1"></i> Dia inteiro</span>{% endif %}
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card card-rounded shadow-soft h-100">
        <div class="card-body">
          <h5 class="card-title"><i class="bi bi-geo-alt me-2"></i>Local</h5>
          <p class="mb-0">{{ e.location|default:"-" }}</p>
        </div>
      </div>
    </div>
    <div class="col-12">
      <div class="card card-rounded shadow-soft">
        <div class="card-body">
          <h5 class="card-title"><i class="bi bi-text-left me-2"></i>Descrição</h5>
          <p class="mb-0">{{ e.description|linebreaksbr|default:"Sem descrição." }}</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.getElementById('copyIcs').addEventListener('click', async ()=>{
      const url = "{{ request.scheme }}://{{ request.get_host }}{% url 'event-export-ics' e.id %}";
      try {
        await navigator.clipboard.writeText(url);
        const el = document.createElement('div');
        el.className = 'toast show position-fixed bottom-0 end-0 m-3';
        el.innerHTML = `<div class="toast-body">
          <i class="bi bi-check-circle text-success me-2"></i>Link copiado!
        </div>`;
        document.getElementById('toastArea').appendChild(el);
        new bootstrap.Toast(el, {delay: 2000}).show();
      } catch(e){}
    });
  </script>
{% endblock %}
